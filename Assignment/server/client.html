<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link id="favicon" rel="shortcut icon" type="image/png" href="data:image/png;base64,....==" />
    <title>Tool App</title>
    <script type="importmap">
        {
          "imports": {
            "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js"
          }
        }
    </script>
</head>
<body>
    <h1>Tool App</h1>
    <div id="app">

        <h2>Create</h2>
        <form @submit.prevent="createItem">
            <input v-model="item.user_id" name="user_id" placeholder="user_id">
            <input v-model="item.lat" name="lat" placeholder="lat">
            <input v-model="item.lon" name="lon" placeholder="lon">
            <input v-model="item.image" name="image" placeholder="image">
            <input v-model="item.keywords" name="keywords" placeholder="keywords">
            <textarea v-model="item.description" name="description" placeholder="description"></textarea>
            <button type="submit">Create Item</button>
        </form>

        <h2>Items</h2>
        <ul>
            <li v-for="item in items" :key="item.id">
                <img :src="item.image">
                <span data-field="item_id">{{ item.id }}</span>
                <span data-field="lat">{{ item.lat }}</span>
                <span data-field="lon">{{ item.lon }}</span>
                <span data-field="image">{{ item.image }}</span>
                <span data-field="keywords">{{ item.keywords }}</span>
                <span data-field="description">{{ item.description }}</span>
                <button  data-action="delete" @click="deleteItem(item.id)">Delete</button>
            </li>
        </ul>

    </div>

    <script type="module">
        import { createApp } from 'vue'

        //const urlParams = new URLSearchParams(window.location.search);
        //const urlAPI = (urlParams.get('api') || '/api/v1').replace(/\/$/, '');
        const urlAPI = ''

        const RootComponent = {
            data() {
                return {
                    item: {
                        item_id: "",
                        lat: "",
                        lon: "",
                        image: "",
                        keywords: "",
                        description: "",
                    },
                    items: [],
                };
            },
            created() {
                this.getItems();
                this.clearInput();
            },
            components: {
            },
            methods: {
                getItems() {
                    fetch(`${urlAPI}/items`)
                        .then(response => response.json())
                        .then(json => {
                            this.items = json;
                        })
                        .catch(err => console.error(err));
                },
                clearInput() {
			this.attendee = {...this.attendee, ...{
				id: Math.random(),
				name: undefined,
				notes: undefined,
			}}
		},
                addItem() {
                    fetch(`${urlAPI}/item`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(this.item),
                    })
                        .then(response => response.json())
                        .then(()=>this.clearInput())
                        .then(()=>getItems())
                        .catch(err => console.error(err));
                },
                deleteItem(id) {
                    fetch(`${urlAPI}/item/${id}`, {
                        method: "DELETE",
                    })
                        .then(() =>this.getItems())
                        .catch(err => console.error(err));
                            
                },
            },
        };
        const app = createApp(RootComponent)
        const vm = app.mount("#app");
    </script>

</body>
</html>
